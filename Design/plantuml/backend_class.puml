@startuml backend

skinparam linetype ortho

package git {
  interface History {
    Branch getBranch(branch: String, benchmark: String)
  }

  interface RepositoryHandler {
    List<Commit> fetchGitHistory(branch: String)
  }

  class CachingDecorator {
    component: GitHistory
    List<Branch>: lastUsedBranches
  }
  
  class Commit {
    previousCommit: Commit
    sha: String
    message: String
    date: java.util.Date
    benchmarkResultsByDevice: HashMap<String, BenchmarkResult>
    String getCommitMessage()
    String getSha()
    String getDiff() or smth like that?
    BenchmarkResult getBenchmarResult(device: String)
    Commit getPreviousCommit()
  }
  
  
  class Branch {
    name: String
    benchmark: String
    commits: List<Commit>
    Commit getCommit(sha: String)
    List<Commit> toList()
  }
    
  interface BenchmarkResult {
    String toJson()
    double getSummaryValue()
  }
  
  class BenchmarkResultTypeA
  class EmptyBenchmarkResult
  
  
  BenchmarkResult <|-- EmptyBenchmarkResult
  BenchmarkResult <|-- BenchmarkResultTypeA
  
  History o-- Branch
  History --> RepositoryHandler
  History <|-- CachingDecorator
  History o-- CachingDecorator
  
  Branch o-- Commit
  Commit "1" -- "1" BenchmarkResult
}


package rest {
  class GitApiHandler
  class SpringRestHandler
  
  interface RestHandler {
    void handlePost(json: String)
    void handleGetHistory(json: String)
    void handleGetBenchmarkResult(json: String)
  }
   
  SpringRestHandler --|> RestHandler
}

package database {
  class PostgreSQLHandler
  
  interface DatabaseHandler {
    void updateCommits(commits: List<Commit>)
    void updateBenchmarkResults(results: List<BenchmarkResult>)
    Branch fetchBranch(branch: String, benchmark: String)
  }
  
  DatabaseHandler <- HistoryDatabase
  DatabaseHandler <|-- PostgreSQLHandler
  
  class HistoryDatabase {
    Branch getBranch(branch: String, benchmark: String)
  }
  
  class LazyBenchmarkResult {
    component: BenchmarkResult
  }

  DatabaseHandler <-- LazyBenchmarkResult
}

History <--- RestHandler
History <|--- HistoryDatabase
RepositoryHandler <|--- GitApiHandler
DatabaseHandler ---> Commit
DatabaseHandler ---> BenchmarkResult
HistoryDatabase ---> Branch
BenchmarkResult <|--- LazyBenchmarkResult
BenchmarkResult <--- LazyBenchmarkResult
@enduml
